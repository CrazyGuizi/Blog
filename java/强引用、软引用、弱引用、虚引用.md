# 目的

把引用分为这几种类型主要是为了配合垃圾回收器的工作，同时更灵活地控制对象的生命周期。这四种引用中的软引用`SoftRefernce`、弱引用`WeakReference`、虚引用`PhantomReference`均有对应的类，他们都继承于`Reference`，这些类在jdk中`java.lang.ref`下，此外还有一个引用队列`ReferenceQueue`类，当JVM检测到适当的可达性发生改变时，会将已经注册的引用对象放置到队列中。引用对象也是对象，当引用对象不再需要的时候需要释放内存，可以程序员手动清除，也可交由gc处理，采用何种方式取决于在构造方法中是否传入`ReferenceQueue`参数。当引用对象所指向的对象除了引用对象外没有其他引用时，这个对象会被gc回收，而引用对象会被加入到引用队列中。引用队列的`pull`方法会返回引用队列中的对象，如果不存在则返回`null`。java的垃圾回收器在回收对象时有不同的策略，但一般采用的是根可达性分析算法，发生gc的时候从`GC Roots`起点搜索，当发现对象是不可达的会标记为可回收对象。根据这几种引用类型，可分为强可达、软可达、弱可达、虚可达和不可达。有时候对象之间是有多个引用的，并且也存在互相引用的情况。判断一个对象的可达性可由以下两点决定：
- 单条引用路径中以最弱的为对象的可达性
- 多条引用路径中以最强的为对象的可达性

![可达性说明](BAFBE205BA5F49379BE708CB51E1997E)

如图，在单条1->2->4中4对象为软可达，在单条1->3->4中为弱可达，如果同时有这两条路径则对象4为软可达。

# 强引用

java中并没有`StringReference`这个类，在平时开发中使用的`Objecet obj = new Object()`便是一个强引用的例子。垃圾回收器宁肯抛出`OutOfMemoryError`也不会回收具有强引用的对象。

# 软引用（SoftReference）

声明一个软引用的方式为：
~~~java
Object o = new Object();
SoftReference<Object> s = new SoftReference<Object>();
~~~
所有软可达的对象会在抛出`OutOfMemoryError`前被清除，软引用常被用于设计缓存。

# 弱引用(WeakReference)

生命周期短，不论内存是否充裕，只要在垃圾回收器扫描的区域中，被扫描到就会被回收。

# 虚引用
只持有虚引用的对象如同没有任何引用，随时会被清除回收。调用虚引用的`get`方法始终返回`null`。虚引用不旨在引用对象，而是用来跟踪对象被垃圾回收器回收的活动。
